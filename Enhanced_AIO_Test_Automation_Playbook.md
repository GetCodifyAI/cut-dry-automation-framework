# Enhanced AIO Test Automation Playbook

## Overview
This playbook provides a streamlined approach for generating automated TestNG test cases from AIO test case specifications. Given three simple inputs (Test Case ID, URL, and Login Credentials), the system automatically generates framework-compliant test cases that maximize reuse of existing methods while creating new ones when necessary.

## Input Parameters

### Required Inputs
1. **Test Case ID**: AIO test case identifier (e.g., `DOT-TC-1836`)
2. **Application URL**: Target application URL (e.g., `https://supplier-uat.staging.cutanddry.com`)
3. **Login Credentials**: Authentication details
   - Username/Email: `415-505-5531`
   - Password: `NovaN@123`

### Example Usage
```bash
./generate-test-from-aio.sh DOT-TC-1836 https://supplier-uat.staging.cutanddry.com 415-505-5531 NovaN@123
```

## Automated Workflow

### Phase 1: AIO Data Retrieval
The system automatically:
1. **Fetches Test Case Details** from AIO API using the provided Test Case ID
2. **Parses Test Structure** including steps, expected results, and preconditions
3. **Validates Data Completeness** ensuring all required fields are present

**API Endpoint**: `GET /api/v1/project/DOT/testcase/{testCaseId}/detail`

**Retrieved Data Structure**:
```json
{
  "key": "DOT-TC-1836",
  "title": "Verify Distributor order submission",
  "description": "Test case description",
  "precondition": "User should be logged in as distributor",
  "steps": [
    {
      "step": "Login as distributor",
      "data": "Valid credentials",
      "expectedResult": "User successfully logged in"
    }
  ],
  "folder": "Order Management"
}
```

### Phase 2: Framework Integration Analysis
The system performs intelligent mapping:

#### 2.1 Existing Method Discovery
**Priority Order**:
1. **Exact Match**: Direct method name matches (e.g., "login as distributor" → `Login.loginAsDistributor()`)
2. **Pattern Match**: Keyword-based matching using regex patterns
3. **Semantic Match**: Context-based method selection
4. **Fallback**: Create new method if no suitable match exists

**Method Mapping Examples**:
```java
// Step: "Login as distributor" → Existing Method
Login.loginAsDistributor(user.getEmailOrMobile(), user.getPassword());

// Step: "Navigate to customers" → Existing Method  
Dashboard.navigateToCustomers();

// Step: "Search customer by code" → Existing Method
Customer.searchCustomerByCode(customerId);

// Step: "Add item to cart" → Existing Method
Customer.increaseFirstRowQtyByOne();

// Step: "Submit order" → Existing Method
Customer.submitOrder();
```

#### 2.2 Framework Standards Compliance
**Automatic Adherence**:
- **TestNG Annotations**: `@Test`, `@BeforeMethod`, `@AfterMethod`
- **Group Assignment**: Uses Test Case ID (e.g., `groups = "DOT-TC-1836"`)
- **SoftAssert Usage**: Multiple validations within single test
- **WebDriver Lifecycle**: Proper initialization and cleanup
- **Screenshot Capture**: Automatic on test failure
- **Test Data Integration**: Uses centralized test data constants

#### 2.3 Package Structure Determination
**Automatic Package Selection**:
```java
// Based on AIO folder/title analysis
"Order Management" → com.cutanddry.qa.tests.order_guide
"Customer Management" → com.cutanddry.qa.tests.customers  
"Catalog Management" → com.cutanddry.qa.tests.catalog
"Payment Processing" → com.cutanddry.qa.tests.pay
```

### Phase 3: Intelligent Code Generation

#### 3.1 Test Class Structure
**Auto-Generated Template**:
```java
package com.cutanddry.qa.tests.{auto_determined_package};

import com.cutanddry.qa.base.TestBase;
import com.cutanddry.qa.data.models.User;
import com.cutanddry.qa.data.testdata.CustomerData;
import com.cutanddry.qa.functions.*;
import com.cutanddry.qa.utils.JsonUtil;
import org.testng.ITestResult;
import org.testng.annotations.*;
import org.testng.asserts.SoftAssert;

public class {AutoGeneratedClassName}Test extends TestBase {
    static User user;
    String customerId = CustomerData.CUSTOMER_CODE3;
    String applicationUrl = "{PROVIDED_URL}";

    @BeforeMethod
    public void setUp(){
        initialization();
        user = JsonUtil.readUserLogin();
        // Override with provided credentials if different
        user.setEmailOrMobile("{PROVIDED_USERNAME}");
        user.setPassword("{PROVIDED_PASSWORD}");
    }

    @Test(groups = "{TEST_CASE_ID}")
    public void {AutoGeneratedMethodName}() throws InterruptedException {
        SoftAssert softAssert = new SoftAssert();
        
        // Auto-generated test steps based on AIO data
        // Each step mapped to existing framework methods
        // New methods created only when necessary
        
        softAssert.assertAll();
    }

    @AfterMethod
    public void tearDown(ITestResult result) {
        takeScreenshotOnFailure(result);
        closeAllBrowsers();
    }
}
```

#### 3.2 Intelligent Step Implementation
**Step Analysis Process**:
1. **Parse Step Text**: Extract action keywords and context
2. **Search Existing Methods**: Query framework for matching functionality
3. **Validate Method Compatibility**: Ensure method signatures match requirements
4. **Generate Method Call**: Create appropriate method invocation with parameters
5. **Add Assertions**: Include validation based on expected results

**Example Step Processing**:
```java
// AIO Step: "Login as distributor with valid credentials"
// Analysis: Action=login, Role=distributor, Data=credentials
// Existing Method Found: Login.loginAsDistributor(String email, String password)
// Generated Code:
Login.loginAsDistributor(user.getEmailOrMobile(), user.getPassword());
softAssert.assertTrue(Dashboard.isUserNavigatedToDashboard(), 
    "Login failed - user not navigated to dashboard");
```

#### 3.3 New Method Creation (When Necessary)
**Criteria for New Method Creation**:
- No existing method matches the required functionality
- Existing method doesn't support required parameters
- Step requires unique business logic not covered by framework

**New Method Template**:
```java
// If new method needed in Customer.java
public static boolean performCustomAction(String parameter) {
    try {
        // Implementation based on AIO step description
        // Following framework patterns and conventions
        return true;
    } catch (Exception e) {
        System.err.println("Error in performCustomAction: " + e.getMessage());
        return false;
    }
}
```

### Phase 4: Quality Assurance

#### 4.1 Automated Validation
**Compilation Check**:
```bash
mvn clean compile -DskipTests
```

**Test Execution Validation**:
```bash
mvn test -Dtest={GeneratedTestClassName} -Drun.headless=true -Dtest.env=uat
```

#### 4.2 Framework Compliance Verification
**Automated Checks**:
- ✅ Proper import statements
- ✅ TestNG lifecycle methods present
- ✅ SoftAssert usage for multiple validations
- ✅ Group annotation matches Test Case ID
- ✅ WebDriver initialization in @BeforeMethod
- ✅ Screenshot capture in @AfterMethod
- ✅ No compilation errors

#### 4.3 Regression Suite Integration
**Automatic Suite Selection**:
```java
// Determines best regression suite based on:
// 1. Test category/package
// 2. Current suite sizes
// 3. Load balancing across suites

RegressionSuiteUpdater.addTestToSuite(className, packageName, projectRoot);
```

## Enhanced Utility Classes

### Core Components

#### 1. Enhanced AioTestCaseRetriever
```java
public class AioTestCaseRetriever {
    public static AioTestCase getTestCaseDetails(String testCaseId, String url, String username, String password) {
        // Retrieves test case and enriches with provided parameters
        AioTestCase testCase = fetchFromAIO(testCaseId);
        testCase.setApplicationUrl(url);
        testCase.setTestCredentials(username, password);
        return testCase;
    }
}
```

#### 2. Intelligent Method Mapper
```java
public class IntelligentMethodMapper {
    public static List<MethodMapping> mapStepsToMethods(List<TestStep> steps) {
        // Advanced mapping using:
        // - Keyword analysis
        // - Context understanding  
        // - Method signature matching
        // - Parameter compatibility
    }
    
    public static boolean methodExists(String methodSignature) {
        // Scans framework for existing method availability
    }
    
    public static String generateNewMethod(TestStep step) {
        // Creates new method when existing ones don't suffice
    }
}
```

#### 3. Framework Standards Enforcer
```java
public class FrameworkStandardsEnforcer {
    public static void validateGeneratedCode(String testClassCode) {
        // Ensures compliance with:
        // - Naming conventions
        // - Import organization
        // - Annotation usage
        // - Error handling patterns
    }
}
```

## Command Line Interface

### Single Test Generation
```bash
# Generate single test case
./generate-test-from-aio.sh DOT-TC-1836 https://supplier-uat.staging.cutanddry.com 415-505-5531 NovaN@123

# Output:
# ✅ Retrieved test case: DOT-TC-1836
# ✅ Mapped 5/6 steps to existing methods
# ✅ Created 1 new method: Customer.validateOrderConfirmation()
# ✅ Generated test class: VerifyDistributorOrderSubmissionTest.java
# ✅ Added to regression suite: regression3.xml
# ✅ Compilation successful
# ✅ Test execution successful
```

### Batch Test Generation
```bash
# Generate multiple test cases
./batch-generate-tests.sh test-cases.txt

# test-cases.txt format:
# DOT-TC-1836,https://supplier-uat.staging.cutanddry.com,415-505-5531,NovaN@123
# DOT-TC-1837,https://supplier-uat.staging.cutanddry.com,415-505-5531,NovaN@123
```

### Interactive Mode
```bash
# Interactive test generation
./interactive-test-generator.sh

# Prompts for:
# - Test Case ID
# - Application URL  
# - Username
# - Password
# - Additional parameters
```

## Advanced Features

### 1. Smart Parameter Detection
**Automatic Parameter Extraction**:
- Detects customer codes from test data
- Identifies product SKUs from test steps
- Extracts order quantities from descriptions
- Recognizes date/time requirements

### 2. Cross-Reference Validation
**Framework Integration Checks**:
- Validates page object availability
- Confirms function class methods
- Verifies test data constants
- Checks import dependencies

### 3. Adaptive Learning
**Pattern Recognition Improvement**:
- Learns from successful mappings
- Improves step-to-method associations
- Refines code generation templates
- Enhances error handling patterns

### 4. Environment Configuration
**Multi-Environment Support**:
```java
// Automatic environment detection and configuration
public class EnvironmentManager {
    public static void configureEnvironment(String url) {
        if (url.contains("staging")) {
            System.setProperty("test.env", "uat");
        } else if (url.contains("production")) {
            System.setProperty("test.env", "prod");
        }
        // Additional environment-specific configurations
    }
}
```

## Error Handling and Recovery

### 1. AIO API Failures
**Fallback Strategies**:
- Retry with exponential backoff
- Cache previous successful responses
- Manual input prompts for missing data
- Graceful degradation to manual mode

### 2. Method Mapping Failures
**Recovery Options**:
- Suggest similar existing methods
- Provide manual mapping interface
- Generate placeholder methods
- Create detailed TODO comments

### 3. Compilation Errors
**Auto-Resolution**:
- Missing import detection and addition
- Method signature correction
- Parameter type conversion
- Dependency resolution

## Best Practices Integration

### 1. Code Quality Standards
**Automatic Enforcement**:
- No unnecessary comments (unless explicitly requested)
- Consistent naming conventions
- Proper exception handling
- Resource cleanup in finally blocks

### 2. Test Design Principles
**Built-in Best Practices**:
- Single responsibility per test method
- Clear assertion messages
- Proper test data isolation
- Meaningful test method names

### 3. Maintenance Considerations
**Future-Proofing**:
- Modular code structure
- Configurable parameters
- Version compatibility checks
- Documentation generation

## Success Metrics

### Automation Efficiency
- **Generation Time**: < 2 minutes from input to PR
- **Method Reuse Rate**: > 85% existing methods utilized
- **Compilation Success**: > 98% first-time compilation
- **Test Execution Success**: > 95% generated tests pass

### Quality Metrics
- **Framework Compliance**: 100% adherence to standards
- **Code Coverage**: Generated tests cover all specified steps
- **Error Handling**: Comprehensive exception management
- **Documentation**: Auto-generated inline documentation

## Usage Examples

### Example 1: Order Management Test
**Input**:
```bash
./generate-test-from-aio.sh DOT-TC-1836 https://supplier-uat.staging.cutanddry.com 415-505-5531 NovaN@123
```

**Generated Output**:
```java
@Test(groups = "DOT-TC-1836")
public void VerifyDistributorOrderSubmission() throws InterruptedException {
    SoftAssert softAssert = new SoftAssert();
    
    // Step 1: Login as distributor
    Login.loginAsDistributor(user.getEmailOrMobile(), user.getPassword());
    softAssert.assertTrue(Dashboard.isUserNavigatedToDashboard(), 
        "Login failed - user not navigated to dashboard");
    
    // Step 2: Navigate to customers
    Dashboard.navigateToCustomers();
    softAssert.assertTrue(Customer.isCustomersTextDisplayed(), 
        "Customers section not displayed");
    
    // Step 3: Search customer by code
    Customer.searchCustomerByCode(customerId);
    softAssert.assertTrue(Customer.isCustomerSearchResultByCodeDisplayed(customerId), 
        "Customer search result not displayed");
    
    // Step 4: Access order guide
    Customer.clickOnOrderGuide(customerId);
    
    // Step 5: Add items to cart
    Customer.increaseFirstRowQtyByOne();
    softAssert.assertTrue(Integer.parseInt(Customer.getItemQtyFirstRow()) > 0, 
        "Product quantity not increased");
    
    // Step 6: Checkout items
    Customer.checkoutItems();
    softAssert.assertTrue(Customer.isReviewOrderTextDisplayed(), 
        "Review order page not displayed");
    
    // Step 7: Submit order
    Customer.submitOrder();
    softAssert.assertTrue(Customer.isThankingForOrderPopupDisplayed(), 
        "Order submission confirmation not displayed");
    
    softAssert.assertAll();
}
```

### Example 2: Catalog Management Test
**Input**:
```bash
./generate-test-from-aio.sh DOT-TC-2001 https://supplier-uat.staging.cutanddry.com 415-505-5531 NovaN@123
```

**Auto-Generated Features**:
- Package: `com.cutanddry.qa.tests.catalog`
- Reuses: `Dashboard.navigateToCatalog()`, `Catalog.searchProduct()`
- Creates: `Catalog.validateProductDetails()` (if needed)
- Adds to: Most suitable regression suite

## Conclusion

This enhanced playbook transforms AIO test case automation from a manual, multi-step process into a simple three-parameter command. The system intelligently leverages existing framework methods while seamlessly creating new ones when necessary, ensuring 100% framework compliance and maximum code reuse.

**Key Benefits**:
- **Simplicity**: Three inputs generate complete test cases
- **Intelligence**: Smart method mapping and parameter handling
- **Compliance**: Automatic framework standards adherence
- **Efficiency**: Minimal manual intervention required
- **Quality**: Built-in validation and error handling
- **Scalability**: Supports batch processing and multiple environments

The system evolves continuously, learning from each generation to improve accuracy and efficiency over time.
